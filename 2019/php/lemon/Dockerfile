FROM php:7-apache

RUN chown root /var/www/html
RUN chmod 555 /var/www/html

RUN echo "PD9waHANCmNsYXNzIHhvcl9maWx0ZXIgZXh0ZW5kcyBwaHBfdXNlcl9maWx0ZXIgew0KICAgIHZhciAka2V5Ow0KDQogICAgZnVuY3Rpb24gZmlsdGVyKCRpbiwgJG91dCwgJiRjb25zdW1lZCwgJGNsb3NpbmcpIHsNCiAgICAgICAgd2hpbGUgKCRidWNrZXQgPSBzdHJlYW1fYnVja2V0X21ha2Vfd3JpdGVhYmxlKCRpbikpIHsNCiAgICAgICAgICAgICRidWNrZXQtPmRhdGEgXj0gc3RyX3JlcGVhdCgkdGhpcy0+a2V5LCAxICsgaW50dmFsKCRidWNrZXQtPmRhdGFsZW4gLyA4KSk7DQogICAgICAgICAgICAkY29uc3VtZWQgKz0gJGJ1Y2tldC0+ZGF0YWxlbjsNCiAgICAgICAgICAgIHN0cmVhbV9idWNrZXRfYXBwZW5kKCRvdXQsICRidWNrZXQpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBQU0ZTX1BBU1NfT047DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb25DcmVhdGUoKSB7DQogICAgICAgICR0aGlzLT5rZXkgPSBzdWJzdHIoJHRoaXMtPmZpbHRlcm5hbWUsIDQpOw0KICAgICAgICByZXR1cm4gc3RybGVuKCR0aGlzLT5rZXkpID09IDg7DQogICAgfQ0KfQ0KDQpzdHJlYW1fZmlsdGVyX3JlZ2lzdGVyKCJ4b3IuKiIsInhvcl9maWx0ZXIiKTsNCigkXz1AJF9HRVRbIvCfjYsiXSkgPyBAaW5jbHVkZSgkXy4i8J+NiyIpIDogaGlnaGxpZ2h0X2ZpbGUoX19GSUxFX18pOw==" | base64 -d > /var/www/html/index.php

COPY proof.txt /checksec.sh
RUN chmod 111 /checksec.sh