FROM php:7-apache

RUN chown root /var/www/html
RUN chmod 555 /var/www/html

RUN echo "PD9waHANCmNsYXNzIE1hcm1hbGFkZSB7DQoJdmFyICRzcGljZTsNCgl2YXIgJHNhbHQ7DQoNCglmdW5jdGlvbiBfX2NvbnN0cnVjdCgkc3BpY2UsICRzYWx0ID0gIiIpIHsNCgkJJHRoaXMtPnNwaWNlID0gJHNwaWNlOw0KCQkkdGhpcy0+c2FsdCA9ICRzYWx0Ow0KCX0NCg0KCWZ1bmN0aW9uIF9fZGVzdHJ1Y3QoKSB7DQoJCSRHTE9CQUxTWyJmaWxlIl0gPSBAKCR0aGlzLT5zYWx0IC4gImZpbGUiKSguLi4kdGhpcy0+c3BpY2UpOw0KCX0NCg0KCWZ1bmN0aW9uIF9fdG9TdHJpbmcoKSB7DQoJCXJldHVybiBAKHN0cmluZykgJHRoaXMtPnNhbHQ7DQoJfQ0KfQ0KDQooJF89QCRfR0VUWyLwn42KIl0pID8gbmV3IE1hcm1hbGFkZShbJF9dKSA6IChpc3NldCgkXykgPyBuZXcgTWFybWFsYWRlKFskXz1AJF9GSUxFU1swXVsidG1wX25hbWUiXSwgInRtcC8iIC4gbmV3IE1hcm1hbGFkZShbJF9dKSAuIGhhc2goJF89InNoYTI1NiIsIEBpbXBsb2RlKCRfLCAkZmlsZSkpIC4gIi4kXyJdLCAibW92ZV91cGxvYWRlZF8iKSA6IG5ldyBNYXJtYWxhZGUoW19fRklMRV9fXSwgImhpZ2hsaWdodF8iKSk7" | base64 -d > /var/www/html/index.php

RUN mkdir /var/www/html/tmp
RUN chown www-data /var/www/html/tmp
RUN touch /var/www/html/tmp/index.html

COPY proof.txt /checksec.sh
RUN chmod 111 /checksec.sh